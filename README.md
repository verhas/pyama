# pyama

Pyama is a command line automated editor that performs some of the tasks that are
otherwise performed manually using some editors. It can be used to modify text
source files in any programming languages inserting or updating boiler plate code.

Modifying the source code programmatically is usually not a good practice. Don't do
that if it is possible. Pyama is a practical tool to amend the code editing workflow.
If you have to generate code, it means that your editing process is not optimal.
The reason can be the insufficiencies of some of the tools. For example you generate
getters and setters into the source code, because Java is an old language and does not
generate automatically the setters and getters during compilation time. But getters and
setters are generated by any editors, that is simple.

## Sample Problems Needing Pyama

### Converting object to Map and back

I faced other issues that are almost as simple as generating setters and getters, but being
specific they are not supported by the IDE. I had many Java classes that I needed to
convert to `Map` and from `Map` to object. The general solution would have been to 
create a reflection tool that reads the fields of the object and generates the `Map`
and another that reads the values from the `Map` and writed the fields of the object.
For some technical reasons (some of which could have been coped with though) using
reflection was not an option. We ended up hand coding the back and forth conversions.
(Also know that I simplified the issue, the real life problem was more complex.) 


### Include code snippets to documentation

Another issue I faced during my practice is that most of the markup languages do not
allow to include a snippet from other source files. For example usign markdown
you can have some sample code like the following:

[//]: # (USE SNIPPET run.py/run_py)
```python
from pyama.configuration import Configuration
from pyama.snippet import MdSnippetWriter, SnippetReader
from pyama.processor import Processor


MD = Configuration().file(".*\\.md$").handler(MdSnippetWriter())
PY = Configuration().file(".*\\.py$").handler(SnippetReader())

configs = [MD,PY]
Processor(configs, "**/*.*").process()
``` 

I wanted to have these code fragments copied from the source code, usually from
unit test files. Whenever the unit test changed it had to be copied to the documentation.

The first solution was to use some existing macro tool that processed some mainly
markdown file and generated the markdown. Then I faced that the editors that show the
markdown wysiwyg could not cope with the file that still neded preprocessing.

What I actually wanted was to automate the copy paste from the unit test code to the
documentation, and that is what pyama does.

## What is Pyama

Pyama reads a set of files, extracts information from these files and then selects some
of the files and overwrites some part of those files. It automates the modification of
the source files that are kind of redundant. The way it works general and extendable,
configurable. To use it you do not need to understand Python, though it does not hurt.

Typically you will install pyama into your development environment and you create a `run.py`
file in your development root directory. You can name it any way you want btw. It will
be a pythong source file. The actual `run.py` of this project you can see above.

Yes it was copied into this md file using pyama. This little program declares the
configuration that, in this case, says we are using markdown and python source files and
we define two segment handlers. We will discuss them later. They need a bit of python
knowledge but pyama is designed so that it is extremely easy to create segment handlers.

After the declaration of the file types and how we want to handle them we invoke the
pyama processor and generally that is it. Pyama reads all the files that match `**/*.*`
and calls the handlers to do their work. `SnippetReader` is written to read the
code fragments from the python source files and `MdSnippetWriter` is written
to modify the markdown files where it has to copy some of the code fragments
the other segment handlet collected before.

Segments in python start with the line

```python
# START SNIPPET run_py
``` 

and the end of the segment is

```python
# END SNIPPET
```

The `run_py` is the name of the snippet. The `SnippetReader` will copy the lines between
the start and end line into the memory and when `MdSnippetWriter` is executed it will
be available in a python dictionary.

Similarly segments in the markdown files starts with 


```
[//]: # (USE SNIPPET run.py/run__py)
```

and ends with a line that contains only three backtick. The keywords `USE SNIPPET` tell
pyama to start a new segment and the `run.py/run_py` tells the segment handler
`MdSnippetWriter` that it has to replace the content of the segment as it is now
to the snippet that came from the file `run.py` and is named `run_py`. (Note that in the
sample above I had to replace `run_py` with `run__py` otherwise pyama was recognizing
it as something it could process.)

## More documentation

If you have the segment handlers and can run python code and you are satisfied then 
there is no point to read on. The application can be installed with minimal python
infrastucture knowledge and the `run.py` can easily be created without really
understanding python.

However if you need something that is not available and want to write segment handler(s)
then go on.

* [Architecture, structure of pyama](./doc/architecture.md)
* [Writing segment handlers](./doc/segmenthandlers.md)